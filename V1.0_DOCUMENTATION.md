# 小红书爆款内容生成助手 V1.0 - 完整开发文档

**文档版本**: V1.0  
**创建日期**: 2026-01-19  
**作者**: Manus AI

---

## 目录

1. [项目概述](#项目概述)
2. [技术架构](#技术架构)
3. [功能清单](#功能清单)
4. [开发环境配置](#开发环境配置)
5. [API 文档](#api-文档)
6. [数据库设计](#数据库设计)
7. [测试报告](#测试报告)
8. [已知问题与修复方案](#已知问题与修复方案)
9. [后续开发建议](#后续开发建议)

---

## 项目概述

本项目是一个专为留学生申诉场景设计的 **小红书爆款内容生成助手**。该工具通过 AI 技术，帮助用户快速生成符合小红书平台风格的高质量内容，包括标题、正文、话题标签和封面文案。项目已在 GitHub 上开源，并部署了可访问的演示版本。

**核心价值**:

-   **高效创作**: 一键生成多种内容组合，大幅缩短创作时间。
-   **风格统一**: 通过人设管理确保内容风格一致。
-   **数据驱动**: 基于100+爆款案例的分析数据，提升内容互动率。

---

## 技术架构

### 前端架构

前端采用 **React 19** + **Vite** 构建，使用 **TypeScript** 保证类型安全，**TailwindCSS** 和 **Radix UI** 提供现代化的 UI 组件。前端通过 **tRPC Client** 与后端进行类型安全的通信。

**核心技术栈**:

| 技术 | 版本 | 用途 |
| :--- | :--- | :--- |
| React | 19.2.1 | UI 框架 |
| Vite | 7.1.9 | 构建工具 |
| TypeScript | 5.9.3 | 类型系统 |
| TailwindCSS | 4.1.14 | 样式框架 |
| Radix UI | 多个版本 | 无障碍 UI 组件 |
| tRPC Client | 11.6.0 | 类型安全的 RPC 客户端 |
| Wouter | 3.7.1 | 轻量级路由 |

**目录结构**:

```
client/
├── public/          # 静态资源
└── src/
    ├── components/  # 可复用组件
    │   └── ui/      # UI 组件库
    ├── contexts/    # React Context
    ├── hooks/       # 自定义 Hooks
    ├── pages/       # 页面组件
    ├── lib/         # 工具库
    │   ├── trpc.ts  # tRPC 客户端配置
    │   └── utils.ts # 工具函数
    ├── index.css    # 全局样式
    └── main.tsx     # 应用入口
```

### 后端架构

后端基于 **Node.js** + **Express** 构建，使用 **tRPC Server** 提供类型安全的 API 接口。数据库层使用 **Drizzle ORM** 操作 **MySQL**。AI 功能通过 **OpenAI 兼容 API** 实现。

**核心技术栈**:

| 技术 | 版本 | 用途 |
| :--- | :--- | :--- |
| Node.js | 22.13.0 | 运行时环境 |
| Express | 4.21.2 | Web 框架 |
| tRPC Server | 11.6.0 | 类型安全的 RPC 服务器 |
| Drizzle ORM | 0.44.5 | 数据库 ORM |
| MySQL | 3.15.0 (驱动) | 关系型数据库 |
| Zod | 4.1.12 | 数据验证 |

**目录结构**:

```
server/
├── _core/
│   ├── context.ts       # tRPC 上下文创建
│   ├── cookies.ts       # Cookie 管理
│   ├── env.ts           # 环境变量配置
│   ├── index.ts         # 服务器入口
│   ├── llm.ts           # AI 调用封装
│   ├── oauth.ts         # OAuth 认证 (已绕过)
│   ├── trpc.ts          # tRPC 配置
│   └── vite.ts          # Vite 中间件
├── ai.ts                # AI 内容生成逻辑
├── db.ts                # 数据库操作
├── feishu.ts            # 飞书集成
└── routers.ts           # API 路由定义
```

### 数据流

```
用户操作 (前端)
  ↓
tRPC Client (类型安全请求)
  ↓
tRPC Server (路由分发)
  ↓
业务逻辑层 (ai.ts, db.ts)
  ↓
AI API / 数据库
  ↓
响应返回 (类型安全)
  ↓
前端渲染
```

---

## 功能清单

### 已实现功能 (V1.0)

| 功能模块 | 状态 | 说明 |
| :--- | :---: | :--- |
| 首页展示 | ✅ | 展示核心功能、业务场景、情绪类型和快速入口 |
| 多人设管理 | ✅ | 支持4种预设人设（过来人学姐、专业顾问、焦虑求助者、吐槽达人） |
| 智能标题生成 | ⚠️ | 后端逻辑完整，前端调用存在 Bug |
| 笔记正文生成 | ⚠️ | 后端逻辑完整，前端调用存在 Bug |
| 话题标签推荐 | ⚠️ | 后端逻辑完整，前端调用存在 Bug |
| 封面文案生成 | ⚠️ | 后端逻辑完整，前端调用存在 Bug |
| 批量生成 | ✅ | 支持一次生成多篇内容 |
| 历史记录管理 | ✅ | 保存、查看、收藏、删除生成历史 |
| 爆款数据库 | ✅ | 内置100+高互动帖子分析数据 |
| 飞书集成 | ✅ | 支持导出内容到飞书多维表格 |
| 认证绕过 | ✅ | 本地开发无需 OAuth，自动使用模拟用户 |

### 待实现功能 (V1.1+)

-   修复前端 tRPC 调用 Bug
-   完善错误提示和用户反馈
-   添加内容预览功能
-   支持自定义人设
-   添加数据统计和分析面板

---

## 开发环境配置

### 环境要求

-   **Node.js**: v22.x 或更高版本
-   **pnpm**: v10.x 或更高版本
-   **Git**: 任意版本
-   **MySQL**: 可选 (本地开发可跳过)

### 快速启动

1.  **克隆仓库**:
    ```bash
    git clone https://github.com/phuktoley/xiaohongshuCreate.git
    cd xiaohongshuCreate
    ```

2.  **安装依赖**:
    ```bash
    pnpm install
    ```

3.  **配置环境变量**:
    ```bash
    cp .env.example .env
    ```
    编辑 `.env` 文件，填入你的 OpenAI 兼容 API 密钥:
    ```env
    OPENAI_API_KEY=sk-your-api-key-here
    OPENAI_BASE_URL=https://api.openai.com/v1
    LLM_MODEL=gemini-2.5-flash
    ```

4.  **启动开发服务器**:
    ```bash
    pnpm run dev
    ```
    访问 `http://localhost:3000` 查看应用。

### 构建生产版本

```bash
# 构建前端和后端
pnpm run build

# 启动生产服务器
NODE_ENV=production node dist/index.js
```

---

## API 文档

本项目使用 **tRPC** 提供类型安全的 API 接口。以下是主要的 API 路由。

### 认证相关

#### `auth.me`

-   **类型**: Query
-   **描述**: 获取当前用户信息
-   **返回**: `User` 对象

#### `auth.logout`

-   **类型**: Mutation
-   **描述**: 登出当前用户
-   **返回**: `{ success: true }`

### 配置数据

#### `config.getAll`

-   **类型**: Query
-   **描述**: 获取所有配置数据（场景、情绪、标签、学校、人设）
-   **返回**: `{ scenarios, emotions, hashtags, schools, personas }`

### 内容生成

#### `generate.titles`

-   **类型**: Mutation
-   **输入**:
    ```typescript
    {
      scenario: "delay" | "dropout" | "misconduct" | "fail" | "leave" | "withdraw",
      emotion: "empathy" | "warning" | "help" | "success" | "critic",
      personaType: "senior_sister" | "professional" | "anxious" | "critic",
      schoolRegion?: "uk" | "au" | "us" | "ca" | "hk" | "sg" | "eu",
      schoolName?: string,
      customInput?: string
    }
    ```
-   **返回**:
    ```typescript
    {
      titles: Array<{
        text: string,
        score: number,
        emoji: string,
        reason: string
      }>
    }
    ```

#### `generate.note`

-   **类型**: Mutation
-   **输入**:
    ```typescript
    {
      title: string,
      scenario: string,
      emotion: string,
      personaType: string,
      schoolName?: string,
      customInput?: string
    }
    ```
-   **返回**:
    ```typescript
    {
      content: string
    }
    ```

#### `generate.hashtags`

-   **类型**: Mutation
-   **输入**:
    ```typescript
    {
      scenario: string,
      title: string,
      schoolRegion?: string,
      schoolName?: string
    }
    ```
-   **返回**:
    ```typescript
    {
      hashtags: string[]
    }
    ```

#### `generate.cover`

-   **类型**: Mutation
-   **输入**:
    ```typescript
    {
      title: string,
      scenario: string,
      emotion: string
    }
    ```
-   **返回**:
    ```typescript
    {
      mainText: string,
      subText: string,
      colorScheme: {
        primary: string,
        secondary: string,
        highlight: string,
        text: string,
        background: string
      },
      layout: string,
      coverType: string
    }
    ```

---

## 数据库设计

本项目使用 **MySQL** 作为数据库，通过 **Drizzle ORM** 进行操作。以下是主要的数据表结构。

### 人设表 (personas)

| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| id | INT (PK) | 主键 |
| userId | VARCHAR | 用户 ID |
| name | VARCHAR | 人设名称 |
| description | TEXT | 人设描述 |
| greetings | JSON | 常用开头 |
| toneWords | JSON | 语气词 |
| emojiStyle | JSON | emoji 风格 |
| createdAt | TIMESTAMP | 创建时间 |
| updatedAt | TIMESTAMP | 更新时间 |

### 生成历史表 (generations)

| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| id | INT (PK) | 主键 |
| userId | VARCHAR | 用户 ID |
| type | VARCHAR | 类型 (title/note/hashtag/cover) |
| scenario | VARCHAR | 业务场景 |
| emotion | VARCHAR | 目标情绪 |
| input | JSON | 输入参数 |
| output | JSON | 生成结果 |
| isFavorite | BOOLEAN | 是否收藏 |
| createdAt | TIMESTAMP | 创建时间 |

### 爆款内容表 (hotContents)

| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| id | INT (PK) | 主键 |
| title | VARCHAR | 标题 |
| scenario | VARCHAR | 场景 |
| emotion | VARCHAR | 情绪 |
| likes | INT | 点赞数 |
| comments | INT | 评论数 |
| pattern | TEXT | 内容模式 |
| createdAt | TIMESTAMP | 创建时间 |

---

## 测试报告

### 测试环境

-   **测试时间**: 2026-01-19 08:35 - 08:42
-   **测试地址**: https://3000-ibfcewnksucjq9bolcnln-c493786c.sg1.manus.computer
-   **浏览器**: Chromium
-   **测试人员**: Manus AI

### 测试结果

#### 首页加载测试 ✅

-   **页面标题**: 小红书爆款内容生成助手
-   **页面加载**: 正常
-   **UI 渲染**: 完整
-   **导航栏**: 显示正常
-   **用户认证**: 模拟用户登录成功

#### API 连接测试 ✅

-   **API 地址**: https://api.manus.im/api/llm-proxy/v1
-   **模型**: gemini-2.5-flash-preview-09-2025
-   **测试结果**: API 调用成功，返回 200 OK
-   **生成内容**: "**挂科了，但没关系！**"

#### 内容生成功能测试 ❌

-   **测试场景**: 挂科 + 求助型 + 过来人学姐 + 英国 + UCL
-   **错误信息**: "标题生成失败，请重试"
-   **后端日志**: `Invalid input: expected object, received undefined`
-   **问题原因**: 前端 tRPC 调用参数格式错误

### 测试总结

项目的基础架构和 AI 集成均工作正常，但前端在调用 tRPC 接口时存在参数传递问题，导致内容生成功能无法正常使用。该问题已记录在案，并提供了详细的修复建议。

---

## 已知问题与修复方案

### BUG #1: 内容生成失败

**现象**: 点击"开始生成标题"按钮后，页面提示"标题生成失败，请重试"。

**根本原因**: 前端在调用 tRPC 的 `generate.titles` 接口时，请求的 Body 格式不正确。tRPC 期望一个包含 `json` 字段的嵌套对象，但前端直接发送了参数对象。

**后端日志**:
```
Invalid input: expected object, received undefined
```

**修复方案**:

1.  **检查 tRPC Client 配置** (`client/src/lib/trpc.ts`):
    确保 tRPC Client 的配置正确，特别是 `links` 和 `transformer` 的设置。

2.  **检查前端调用方式** (`client/src/pages/Generator.tsx`):
    确认调用 `generateTitles.mutate()` 时，参数是否正确传递。

3.  **快速修复 (临时方案)**:
    在前端调用时，手动包装请求参数:
    ```typescript
    // 错误示例
    generateTitles.mutate(payload);
    
    // 正确示例
    generateTitles.mutate({ json: payload });
    ```

4.  **根本修复 (推荐)**:
    检查 tRPC Client 的 `httpBatchLink` 或 `httpLink` 配置，确保其正确处理请求体的序列化。通常，tRPC Client 会自动处理这一过程，问题可能出在 `superjson` 的配置上。

**优先级**: 🔴 高 (阻塞核心功能)

---

## 后续开发建议

### V1.1 版本计划

1.  **修复 BUG #1**: 优先修复内容生成功能。
2.  **完善错误处理**: 添加更友好的错误提示和用户反馈。
3.  **添加内容预览**: 在生成后提供内容预览和编辑功能。
4.  **优化 UI/UX**: 改进表单交互和加载状态提示。

### V1.2 版本计划

1.  **自定义人设**: 允许用户创建和管理自定义人设。
2.  **数据统计**: 添加生成内容的统计和分析面板。
3.  **批量导出**: 支持批量导出内容到 CSV 或 Excel。
4.  **多语言支持**: 添加英文界面支持。

### 长期规划

-   **AI 模型优化**: 接入更多 AI 模型，提升生成质量。
-   **社区功能**: 添加用户分享和评论功能。
-   **移动端适配**: 优化移动端体验。
-   **API 开放**: 提供 REST API 供第三方集成。

---

## 附录

### 环境变量说明

| 变量名 | 说明 | 默认值 |
| :--- | :--- | :--- |
| `OPENAI_API_KEY` | OpenAI 兼容 API 密钥 | 无 (必填) |
| `OPENAI_BASE_URL` | API 基础 URL | `https://api.openai.com/v1` |
| `LLM_MODEL` | AI 模型名称 | `gemini-2.5-flash` |
| `DATABASE_URL` | MySQL 连接字符串 | 无 (可选) |
| `BATCH_CONCURRENCY` | 批量生成并发数 | `3` |

### 常用命令

```bash
# 安装依赖
pnpm install

# 启动开发服务器
pnpm run dev

# 构建生产版本
pnpm run build

# 启动生产服务器
NODE_ENV=production node dist/index.js

# 运行测试
pnpm run test

# 代码格式化
pnpm run format

# 类型检查
pnpm run check
```

### 联系方式

-   **GitHub 仓库**: https://github.com/phuktoley/xiaohongshuCreate
-   **V1.0 分支**: https://github.com/phuktoley/xiaohongshuCreate/tree/V1.0
-   **问题反馈**: https://github.com/phuktoley/xiaohongshuCreate/issues

---

**文档结束**

*本文档由 Manus AI 自动生成，最后更新于 2026-01-19*
